---
title: "ISTP sampling for cross-sectional studies data"
output: rmarkdown::html_vignette
bibliography: biblio.bib  
vignette: >
  %\VignetteIndexEntry{Sampling-cross}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(pimbayes)
```

### Problem specification

Package \texttt{istp} supports the importance sampling with transparent reparameterization and convenience priors for the problem called cross-sectional studies [@Pirikahu-2021-bcicc].

Data is given in a two-by-two table. 

|               |$D^+$          | $D^-$ |
| ------------- |:-------------:| :-----:|
| $E^+$    |  $x_{11}$ |  $x_{12}$|
| $E^-$    | $x_{21}$  |  $x_{12}$|

where $D+, D^-$ indicate diseased or not and $E^+,E^-$ indicate exposure to the risk factor or not.
Parameter of interests are test sensitivity, $S_e$, specificity, $S_p$, and probabilities of each cell, $\pi_{11} = Pr(E^+ \cap D^+), \pi_{12} = Pr(E^+ \cap  D^-), \pi_{21} = Pr(E^- \cap  D^+)$
However, since this test is imperfect, the actual model is specified with multinomial distribution with $\eta_{ij}$ instead of $\pi_{ij}$ where \begin{align}
\eta_{11} &= Pr(T^+ \cap D^+) &= S_e \pi_{11} + (1-S_p)\pi_{21}\\
\eta_{12} &= Pr(T^+ \cap D^-) &=S_e \pi_{12} + (1-S_e)\pi_{22}\\
\eta_{21} &= Pr(T^- \cap D^+) &= S_p \pi_{21} + (1-S_e)\pi_{11}\\
\eta_{22} &= Pr(T^- \cap D^-) &= (1-S_e) \pi_{12} + S_p\pi_{22}\\
\end{align}

```{r}
data(cross)
print(cross)
```

The data is a vector with four entries, each representing the count of each category $(1,1), (1,2), (2,1), (2,2)$ in the contingency table below.


The applicable JAGS code is:

```{r}
jags_code <-
"model{
    y[1:4] ~ dmulti(eta[1:4], n)
    eta[1:4] <- c(se*pi[1]+(1-sp)*pi[3],
      se*pi[2]+(1-sp)*pi[4],
      sp*pi[3]+(1-se)*pi[1],
      (1-se)*pi[2]+sp*pi[4])
    pi[1:4] ~ ddirch(c(1,1,1,1))
    se ~ dbeta(25,3)
    sp ~ dbeta(30,1.5)
}"
```

When data and JAGS code are given with the desired posterior sample size, the function sampling will return posterior samples along with ESS.

```{r message = F}
data <- list(y = cross, n = sum(cross))

results = sampling(jags_code, data, type = "cross", N = 1000)
results$ess
head(results$samples)
```

# References


